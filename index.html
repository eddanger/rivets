<!DOCTYPE html>  <html> <head>   <title>rivets.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               rivets.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>rivets.js
version : 0.1.2
author : Michael Richards
license : MIT
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Registers a specific binding routine between a model object and a DOM element.
All information for that routine is passed in when calling this function; the
specific element to bind to, an adapter interface for the model object, the
type of binding, the context object and the keypath at which to subscribe to
on the model object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">registerBinding = </span><span class="nf">(el, adapter, type, context, keypath) -&gt;</span>
  <span class="nv">bind = </span><span class="nx">bindings</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="nx">attributeBinding</span> <span class="nx">type</span>
  <span class="nx">bind</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">read</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">keypath</span>

  <span class="nx">adapter</span><span class="p">.</span><span class="nx">subscribe</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">,</span> <span class="nf">(value) -&gt;</span>
    <span class="nx">bind</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">value</span>

  <span class="k">if</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">bidirectionals</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">adapter</span><span class="p">.</span><span class="nx">publish</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">keypath</span><span class="p">,</span> <span class="nx">getInputValue</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Returns the current input value for the specified element.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">getInputValue = </span><span class="nf">(el) -&gt;</span>
  <span class="k">switch</span> <span class="nx">el</span><span class="p">.</span><span class="nx">type</span>
    <span class="k">when</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="s">&#39;textarea&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;select-one&#39;</span> <span class="k">then</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span>
    <span class="k">when</span> <span class="s">&#39;checkbox&#39;</span><span class="p">,</span> <span class="s">&#39;radio&#39;</span> <span class="k">then</span> <span class="nx">el</span><span class="p">.</span><span class="nx">checked</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Returns an attribute binding routine for the specified attribute. This is what
<code>registerBinding</code> falls back to when there is no routine for the binding type.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">attributeBinding = </span><span class="nf">(attr) -&gt;</span> <span class="nf">(el, value) -&gt;</span>
  <span class="k">if</span> <span class="nx">value</span> <span class="k">then</span> <span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">value</span> <span class="k">else</span> <span class="nx">el</span><span class="p">.</span><span class="nx">removeAttribute</span> <span class="nx">attr</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Returns a state binding routine for the specified attribute. Can optionally be
negatively evaluated. This is used to build a lot of the core state binding
routines.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">stateBinding = </span><span class="nf">(attr, inverse = false) -&gt;</span> <span class="nf">(el, value) -&gt;</span>
  <span class="nx">attributeBinding</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="nx">el</span><span class="p">,</span> <span class="k">if</span> <span class="nx">inverse</span> <span class="o">is</span> <span class="o">!</span><span class="nx">value</span> <span class="k">then</span> <span class="nx">attr</span> <span class="k">else</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Core binding routines.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">bindings =</span>
  <span class="nv">checked:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;checked&#39;</span>
  <span class="nv">selected:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;selected&#39;</span>
  <span class="nv">disabled:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;disabled&#39;</span>
  <span class="nv">unchecked:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nv">unselected:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;selected&#39;</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nv">enabled:</span>
    <span class="nx">stateBinding</span> <span class="s">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nv">text: </span><span class="nf">(el, value) -&gt;</span>
    <span class="nv">el.innerText = </span><span class="nx">value</span> <span class="o">or</span> <span class="s">&#39;&#39;</span>
  <span class="nv">html: </span><span class="nf">(el, value) -&gt;</span>
    <span class="nv">el.innerHTML = </span><span class="nx">value</span> <span class="o">or</span> <span class="s">&#39;&#39;</span>
  <span class="nv">value: </span><span class="nf">(el, value) -&gt;</span>
    <span class="nv">el.value = </span><span class="nx">value</span>
  <span class="nv">show: </span><span class="nf">(el, value) -&gt;</span>
    <span class="nv">el.style.display = </span><span class="k">if</span> <span class="nx">value</span> <span class="k">then</span> <span class="s">&#39;&#39;</span> <span class="k">else</span> <span class="s">&#39;none&#39;</span>
  <span class="nv">hide: </span><span class="nf">(el, value) -&gt;</span>
    <span class="nv">el.style.display = </span><span class="k">if</span> <span class="nx">value</span> <span class="k">then</span> <span class="s">&#39;none&#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Bindings that should also be observed for changes on the DOM element in order
to propogate those changes back to the model object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">bidirectionals = </span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;checked&#39;</span><span class="p">,</span> <span class="s">&#39;unchecked&#39;</span><span class="p">,</span> <span class="s">&#39;selected&#39;</span><span class="p">,</span> <span class="s">&#39;unselected&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The rivets module. Exposes a single <code>bind</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rivets =</span>
  <span class="nv">bind: </span><span class="nf">(el, adapter, contexts = {}) -&gt;</span>
    <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getElementsByTagName</span> <span class="s">&#39;*&#39;</span>
      <span class="k">for</span> <span class="nx">attribute</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span>
        <span class="k">if</span> <span class="sr">/^data-/</span><span class="p">.</span><span class="nx">test</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">name</span>
          <span class="nv">type = </span><span class="nx">attribute</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span> <span class="s">&#39;data-&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
          <span class="nv">path = </span><span class="nx">attribute</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;.&#39;</span>
          <span class="nv">context = </span><span class="nx">path</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
          <span class="nv">keypath = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;.&#39;</span>
          <span class="nx">registerBinding</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">contexts</span><span class="p">[</span><span class="nx">context</span><span class="p">],</span> <span class="nx">keypath</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Exports rivets for both CommonJS and the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nx">module</span><span class="o">?</span>
  <span class="nv">module.exports = </span><span class="nx">rivets</span>
<span class="k">else</span>
  <span class="vi">@rivets = </span><span class="nx">rivets</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 